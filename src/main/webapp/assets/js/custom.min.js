var essbase = function(){
	
	var basePath="/";
	var resultTable;
	var renTable;
	var historyTable;
	
	var _init= function(){
		console.log(": init::");
		$("#ip_submit_id").click(function() {
			var form = $(this).closest("form");
			console.log(": form in init::" +form);
			_submitForm(form);
			return false;
		});
	//	_initHistoryTable();
		_loading(false);
		
	};
	var _submitForm = function(form) {
		var _url = basePath+"rest-utils/process";
		console.log(":: form in submit::"+ form.serializeArray());
		var formData = new FormData(form);
		
		var url = form.find("#urlId").val();
		var username = form.find("#usernameId").val();
		var password = form.find("#pwdId").val();
		

		if(url ==null || url == ''){
			alert("ESSBASE Url is required.");
			form.find("#urlId").focus();
			return ;
		}
		if(username ==null || username == ''){
			alert("Username is required.");
			form.find("#usernameId").focus();
			return ;
		}
		if(password ==null || password == ''){
			alert("Password is required.");
			form.find("#jobNameId").focus();
			return ;
		}
	  
	    formData.append("username", username); 
	    formData.append("password", password);
	    formData.append("url", url);
	    _loading(true);

		$.ajax({
			type : "POST",
			url : _url,
			data : formData, // serializes the form's elements.
			dataType: 'json',
		    cache : false,
		    processData: false,
		    contentType:false,
			success : function(data) {
				if(data.status){
					_initDatatable(data)
				}else{
					alert(data.msg);
				}
			},
			complete: function(){
				_loading(false);
			},
		});
	};
	
	var _initDatatable = function(data){
		var headers = [];
		if(resultTable){
			resultTable.destroy();
		}
		for(var h of data.response.headers){
			headers.push({title: h});
		}
		resultTable = $("#result_table").DataTable( {
			dom: '<"row"<"col-sm-3"l><"col-sm-6"f><"col-sm-3"B>>tip',
	        columns: headers,
	        data:  data.response.data,
	        "scrollX": true,
	        fixedColumns:   {
	            leftColumns: 2,
	        },
	        buttons: [
	        	{ extend: 'csv', className: 'csvButton btn btn-primary btn-sm' },
	            { extend: 'excel', className: 'excelButton btn btn-primary btn-sm' }
	        ]
	    });
	};
	
/*	var _initHistoryTable = function() {
		historyTable = $("#history_table").DataTable( {
			dom: '<"row"<"col-sm-3"l><"col-sm-6"f><"col-sm-3"B>>tip',
			"scrollX": true,
			orderCellsTop: true,
			fixedColumns:   {
	            leftColumns: 2,
	        },
			buttons: [
	        	{ extend: 'csv', className: 'csvButton btn btn-primary btn-sm' },
	            { extend: 'excel', className: 'excelButton btn btn-primary btn-sm' }
	        ]
		});
		 
	}; */
/*	var _loadJobs =  function(id){
		$("#historydetailsdiv").removeClass("d-none");
		$("#historydiv").addClass("d-none");
		$("#historyCard").find(".card-header").html("<i class='fas fa-arrow-left mr-3' style='cursor: pointer;' onClick='epbcs.backToHistory()'> </i> <span class=''> Process Details </span>")
		var _url = basePath+"rest-utils/process-details/"+id;
		_loading(true);
		$.ajax({
			type : "GET",
			url : _url,
			dataType: 'json',
			success : function(data) {
				if(data.status){
					_initProcessData(data)
				}else{
					alert(data.msg);
				}
			},
			complete: function(){
				_loading(false);
			},
		});
	
	}*/
/*	var _syncJobs =  function(id, sno, pcount){
		if(parseInt(pcount) == 0){
			alert("All Jobs were processed already.");
			return;
		}
		var _url = basePath+"rest-utils/job-sync/"+id;
		var crow = parseInt(sno);
		var rw = historyTable.row(crow);
		var temp = rw.data();
		_loading(true);
		
		$.ajax({
			type : "GET",
			url : _url,
			dataType: 'json',
			success : function(data) {
				if(data.status){
					temp[4] = data.response.completedJobs;
					temp[5] =  data.response.processingJobs;
					temp[6] = data.response.failedCount;
					historyTable.row( rw ) .data( temp )   .draw(); 
					location.reload();
				}else{
					alert(data.msg);
				}
			},
			complete: function(){
				_loading(false);
			},
		}); 
	};*/
	var _initProcessData = function(data){
		var headers = [];
		if(renTable){
			renTable.destroy();
		}
		for(var h of data.response.headers){
			headers.push({title: h});
		}
		renTable = $("#history_details_table").DataTable( {
			dom: '<"row"<"col-sm-3"l><"col-sm-6"f><"col-sm-3"B>>tip',
	        columns: headers,
	        data:  data.response.data,
	        "scrollX": true,
	        fixedColumns:   {
	            leftColumns: 2,
	        },
	        buttons: [
	        	{ extend: 'csv', className: 'csvButton btn btn-primary btn-sm' },
	            { extend: 'excel', className: 'excelButton btn btn-primary btn-sm' }
	        ]
	    });
	};
	
	
/*	var _downloadTemplate = function(){
		var selectedId = $("#jobNameId").val();
		console.log('::: selected :: '+ selectedId);
		var loc = location.protocol + '//' + location.hostname;
		if(location.port != '80'){
			loc = loc+":"+ location.port;
		}
		window.open(loc+ basePath+"/download/template/"+selectedId);
	}*/
	
	
/*	var _backToHistory =  function(){
		$("#historydiv").removeClass("d-none");
		$("#historydetailsdiv").addClass("d-none");
		$("#historyCard").find(".card-header").html("Process History");
	};*/
	
	var _loading = function(st){
		if(st){
			$("body").addClass("loading");
		}else{
			$("body").removeClass("loading");
		}
	};
	

	return {
		init: _init
		/*loadJobs: function(id){
			_loadJobs(id);
		},
		syncJobs: function(id,sno, pcount){_syncJobs(id, sno, pcount);},
		backToHistory: function(){_backToHistory();},
		downloadTemplate: function(){ _downloadTemplate();},*/
	}
}();